# XSS：跨站请求攻击

## 分类 

1. **存储型**（数据库）：利用表单将恶意代码存入数据库，后端拼接网页返回客户端时触发
2. **反射型**（URL）：构造恶意连接，利用行内JavaScript代码触发。或`javascript:`，或`script`标签

3. **DOM型**：通过恶意输入导致DOM标签闭合，进而执行恶意代码

常见于：

- 在 HTML 中内嵌的文本中，恶意内容以 script     标签形成注入。
- 在内联的 JavaScript 中，拼接的数据突破了原本的限制（字符串，变量，方法名等）。
- 在标签属性中，恶意内容包含引号，从而突破属性值的限制，注入其他属性或者标签。
- 在标签的 href、src 等属性中，包含     javascript: 等可执行代码。

## 预防

- 替换特殊字符。输入过滤存在不确定性，可能会导致乱码问题，因为**预先不知道存储的内容将会用于何处**。适用于输入值类型确定的情况。
- 使用纯前端渲染，将代码和数据分离开，并对数据进行转义处理
- Content Security     Policy：配置受信任的来源
- 验证码，http-only，输入内容长度限制等

 

 

# CSRF：跨站请求伪造

利用已登录的用户在浏览器上遗留的用户信息发送请求。通常需要诱导用户跳转至第三方网站，当页面内可以发图发帖时，可能在本域直接进行。

## 特点

- 通常发生在第三方网站，且被攻击网站无法防止攻击发生。
- 攻击者不能获取到Cookie等具体凭证信息内容，只是冒用。
- 跨站请求可以用各种方式：图片URL、超链接、CORS、Form提交等等。部分请求方式可以直接嵌入在第三方论坛、文章中，难以进行追踪。

## 预防

- 阻止不明外域的访问，提交请求时要求**附加本域才能获取的一些信息**，例如验证码，密码，token等。
- 同源检测：检测请求头部Origin，Referer，这也是图片防盗链的原理。但不是万无一失的，因为某些情况下Referer可以被修改。
- 双重Cookie：将同一个Cookie分别放到请求体参数中和请求头部中，后端比对这两个值是否一致。原理是攻击者无法获取到用户的的Cookie值，仅仅是使用，那么请求体中必然无法设置正确的值，导致校验失败。但有风险，如果其他漏洞导致攻击者可以获取到Cookie则该种方法失效，如XSS。
- Samesite Cookie设置。

 

 

 