---
title: 进程与线程
---

# 并发性

- 并行：两个或多个事件可以在**同一时刻**发生（多核CPU）
- 并发：两个或多个事件可以在**同一时间间隔**发生（单核CPU）

# 共享性

资源可以被多个并发的程序共同使用

- 互斥共享
- 同时使用

# 进程（Process）

- 资源分配和调度的**基本单位**

- 作为程序独立运行的载体，保证程序的正常运行
- 合理的隔离资源，运行环境，提升资源利用率

# 线程（Thread）

- 操作系统运行调度的**最小单位**
- 包含在进程之中，是进程中实际运行工作的单位
- 一个进程可以并发多个线程，多个线程共享进程的资源

操作系统对进程的调度，实际上是对进程中线程的调度，所以说，进程是基本单位，线程是最小单位

# 进程的状态

1. **就绪态**：其他资源（PCB、内存等等）都备好，只差CPU的使用权时，称为就绪态。就绪态的进程通常会形成一个队列，称为就绪队列

其他资源（PCB、内存等等）都备好，只差CPU的使用权时，称为就绪态。就绪态的进程通常会形成一个队列，称为**就绪队列**

2. **执行态**：进程获取CPU资源

3. **阻塞态**：进程因某些原因：如其他设备未就绪而无法执行，从而放弃CPU的状态，称为阻塞态。阻塞的进程通常也会形成一个队列，称作**阻塞队列**

4. **创建态**：创建进程时拥有PCB但其他资源未就绪，称为创建态。分配PCB，插入就绪队列。

5. **终止态**：进程结束由系统清理或者归还PCB的状态，称为终止态。系统清理，资源回收。归还PCB。

![进程的五种状态](/images/process-state.png)

# 进程的同步（通信）

**临界资源**：指随作为共享资源，但不能同时被访问的资源

- 生产消费者模型——对临界区资源的使用没有约定顺序，引发问题
- 哲学家进餐模型 ——极端情况下互相等待造成死锁

其问题的根源是——进程之间没有通信。进程的同步主要解决以下问题：

1. 协调临界资源的使用顺序
2. 使得并发执行的进程可以有效的使用资源，相互合作

## 同步原则

1. 空闲让进：资源无占用，允许使用
2. 忙则等待：资源占用，请求搁置，等待资源释放
3. 有限等待：避免死锁
4. 让权等待：等待时，进程需要让出CPU使用权，进入阻塞态

## 同步方法

1. 消息队列

2. 共享存储

3. 信号量

# 线程同步

1. 互斥信号量

2. 读写锁

3. 条件变量

# 进程调度

1. 就绪队列的排队机制——提高进程调度的效率

2. 调度程序以一定的策略选择就绪进程，分配CPU资源

3. 新老进程的上下文切换机制——保存当前进程的上下文信息，并切换到新进程的上下文

## 调度类型

- 非抢占式：进程一旦获得CPU资源将会一直使用下去，不论什么原因都不会释放，直到进程退出或因I/O阻塞等，自行让出CPU资源。
- 抢占式

|          | 抢占式               | 非抢占式       |
| -------- | :------------------ | :------------- |
| 公平性   | 相对公平             | 不公平         |
| 系统开销 | 频繁切换，开销大     | 切换少，开销小 |
| 应用     | 通用系统（如计算机） | 专用系统       |

## 调度算法

- 先来先服务
- 短进程优先：优先选择估计运行时间最短的进程，不利于长作业进程
- 高优先权调度算法：优先选择优先级更高的进程，使得紧迫任务可以优先处理
- 时间片轮转算法：按照先来先服务排列就绪队列，每个进程分配一个时间片运行，用完则释放CPU资源等待下次分配。是相对公平的调度算法，但不能保证系统的及时响应。

# 死锁

- 竞争资源——共享资源的数量不能满足各进程的需求
- 进程调度顺序不当

## 死锁的必要条件

1. 资源互斥使用：进程对资源的使用是 排他性使用
2. 请求保持：进程至少持有一个资源，又提出新的资源请求，新的资源被占用，请求被阻塞。
3. 资源不可剥夺：进程获得的资源只能自己释放，在未完成之前不能被剥夺
4. 环路等待：资源链成环

## 处理

### 破环死锁的必要条件

1. 请求保持：规定进程运行之前一次性申请所有资源，申请不到就不能运行
2. 不可剥夺：请求新的资源得不到满足时，就要释放已经占有的所有资源
3. 环路等待：可用资源线性排序，进程按需递增申请

### 银行家算法

- 客户申请贷款有限，每次申请需要声明最大资金量
- 银行家能够满足贷款时，都应该给用户贷款
- 客户使用贷款后，能够及时归还贷款

**三张表**：已分配资源表，所需资源表，可分配资源表

![银行家算法](/images/银行家算法1.png)

已分配资源表减去所需资源表，得到还需分配资源表，与可分配资源表进行对比：

![银行家算法2](/images/银行家算法2.png)

